## AI_Trader 1차 수정

```
1. 문제 정의 및 가설 수립
2. 성공 지표 선택
3. 평가 방법 선택
4. 데이터 준비
5. 기본보다 나은 모델 훈련하기
6. 몸집 키우기 : 과대 적합 모델 구축
7. 모델 규제와 하이퍼파라미터 튜닝
```



### 1. 문제 정의 및 가설 수립

```
* 문제 정의
1. 종목은 어떻게 선정할 것인가?
2. 입력 데이터는 무엇인가?
3. 당면한 문제가 어떤 종류인가?
```



1. 종목은 어떻게 선정할 것인가?

* 가설 수립
1. 첫 번째 가설
  H0 : KOSPI200의 주식의 평균 수익률이 0이하이다.
  H1 : KOSPI200사의 주식의 평균 수익률이 0이상이다.

평균 수익률이 0 이하라는 귀무가설을 기각할 수 있는 조건을 가진 종목을 투자 종목 후보군에 포함한다.
-> + 수익률이 예상되는 종목을 연구하기 위함.

2. 두 번째 가설
  H0 : KOSPI200에 속한 해당 종목의 평균 수익률에서 KOSPI200시장의 평균 수익률을 뺀 값이 0이다.
  H1 : KOSPI200에 속한 해당 종목의 평균 수익률에서 KOSPI200시장의 평균 수익률을 뺀 값은 0이 아니다.

귀무가설을 기각할 수 있는 조건을 가진 해당 종목을 투자 종목 후보군에 포함시킨다.
-> 시장보다 높은 수익률을 보이는 종목을 연구하기 위함.



#### 가설 1후보 종목(수익률 기준) : 

셀트리온, 한올바이오파마, 일진머티리얼즈, 영진약품, 한미약품, 한미사이언스, DB하이텍, 대한유화, SK이노베이션, 삼성전기, 후성, JW홀딩스, 대웅제약



### 가설 2 후보 종목(변동성 기준):

셀트리온, 한올바이오파마, 일진머티리얼즈, 영진약품, 한미약품, 한미사이언스



### 바이오 주를 제외했을때, 수익률 기준으로 상위 5 종목:

DB하이텍, 대한유화, SK이노베이션, 삼성전기, 후성



2. 입력 데이터는 무엇인가?

#### 1. 기본 데이터

- 전일 종가 대비 당일 시가 비율 ( open / last close )
- 당일 종가 대비 당일 고가 비율 ( high / close )
- 당일 종가 대비 당일 저가 비율( low / close )
- 당일 종가 대비 전일 종가 비율( close / last close )
- 전일 거래량 대비 당일 거래량 비율 ( volume / last volume )
- 5일 평균 종가 대비 당일 종가 비율 ( close / MA5 close )
- 10일 평균 종가 대비 당일 종가 비율 ( close / MA10 close )
- 20일 평균 종가 대비 당일 종가 비율 ( close / MA20 close )
- 60일 평균 종가 대비 당일 종가 비율 ( close / MA60 close )
- 120일 평균 종가 대비 당일 종가 비율 ( close / MA120 close )
- 5일 평균 거래량 대비 당일 거래량 비율 ( volume / MA5 volume )
- 10일 평균 거래량 대비 당일 거래량 비율( volume / MA10 volume )
- 20일 평균 거래량 대비 당일 거래량 비율 ( volume / MA20 volume )
- 60일 평균 거래량 대비 당일 거래량 비율 ( volume / MA60 volume )
- 120일 평균 거래량 대비 당일 거래량 비율 ( volume / MA120 volume )
- 주식 보유 비율 ( 현재 보유 주식 수 / 최대 보유 가능 주식 수 ) - 높으면, 매도 관점 / 낮으면, 매수 관점
- 포트폴리오 가치 비율 ( 현재 포트폴리오 가치 / 기준 포트폴리오 가치 ) - 정하기 나름
- 에이전트가 연속으로 매수한 횟수
- 에이전트가 연속으로 매도한 횟수
- 20 거래일 동안의 매수 비율
- 20 거래일 동안의 매도 비율

#### 2. 외부 데이터

- 회사에 대한 뉴스 (예-긍정/부정 트윗)
- 회사의 성과에 대한 정보 (시장 점유, 성장률, 시장 가치, 수입, 매출, 영업이익 등)
- 경쟁 회사의 뉴스나 성과
- 산업군의 뉴스
- 거시경제
- 정부 정책
- 주식의 수요와 공급
- 등등

3. 당면한 문제가 어떤 종류인가?

수익률이 날 가능성이 높은 지점에서 주식을 매수하고, 수익률이 날 가능성이 낮은 지점에서 주식을 매도하는 자동화 트레이딩 봇을 개발하는 문제

중요한 문제 :

단타/장타 , 매수/매도를 몇시에 몇 번 할것인가, 매수/매도 규모는 어떻게 할 것인가, 유의미한 입력데이터는 무엇인가

강화학습을 토대로 개발



### 2. 성공 지표 선택

성공의 지표 : 

1. 포트폴리오 가치비율( 현재 포트폴리오 가치 / 기준 포트폴리오 가치)이 +의 방향으로 가는 것.

2. 시장의 평균 수익률보다 더 큰 수익률을 달성

-> 포트폴리오 가치(Portfolio value) : 투자금 잔고+주식 현재가*보유 주식 수



### 3. 평가 방법 선택

#### 검증

- 주식 데이터를 3분할로 나눈다
- 2015.01.01~2018.06.01 을 Train_data
- 2018.06.02~2019.01.20 을 Validation_data
- 2019.01.21~ 미래 을 Test_data
- Agent 앙상블을 이용하여 , Train_data에서 학습한 16개 이상의 Agent 중, validation 데이터에서 Reward가 높은 N개의 Agent를 선발하고 Test_data에서는 선발된 N개 Agent의 평균 정책을 따른다.

#### 문제점

* 앙상블을 적용하더라도 수렴하는 정책 간의 분산이 크다.
* Validation에 대한 Overfitting이 존재할 것이 예상된다.
* 모든 기간에 대해 테스트하기 어렵다.

#### 개선방향

* Train, Validation, Test 데이터를 초기에 분할하지 않고, t 시점 직전까지 모든 데이터를 train과 validation에 사용하고 t+1 시점에 대해 test하는 과정을 반복하는 형식으로 진행해본다. 그리고 각 종목 별 상한과 하한 비율을 부과한다.

* Regularization
* Early Stopping

### 4. 데이터 준비

### 5. 기본보다 나은 모델 훈련하기

기본보다 나은 모델 훈련하기

```
이 단계는 통계적 검정력(statistical power)을 달성하는 것이다.
아주 단순한 모델보다 나은 수준의 작은 모델을 개발한다.
클래스가 10개라면, 0.1 보다 높은 정확도를 내는 모델이 통계적 검정력을 가졌다고 할 수 있다.
클래스가 2개라면, 0.5보다 높은 정확도를 갖는 것이다.
```

이 단계에서 통계적 검정력을 달성하지 못할 경우(Bad) :

```
1번 단계에서 정의한 가설 : [주어진 입력으로 출력을 예측할 수 있다 , 가용한 데이터에 입력과 출력 사이의 관계를 학습하는 데 충분한 정보가 있다]

가 잘못된 것일 수 있다. 그러므로 기획부터 다시 한다.
```

통계적 검정력을 달성했을 경우(Good) :

```
* 중요한 3가지의 선택을 해야한다.

1. 마지막 층의 활성화 함수(이진 분류, 다중 레이블 다중 분류 : sigmoid, 단일 레이블 다중 분류 : softmax, 임의 값에 대한 회귀 : 사용하지 않음, 0~1 사이의 회귀 : sigmoid)
2. 손실 함수(이진 분류, 다중 레이블 다중 분류 : binary_crossentropy, 단일 레이블 다중 분류 : categorical_crossentropy, 임의 값에 대한 회귀 : mse, 0~1 사이의 회귀 : mse 또는 binary_crossentropy)
3. 옵티마이저(rmsprop 또는 Adam등을 일반적으로 무난하게 사용한다)
```



###6 . 몸집 키우기 : 과대 적합 모델 구축

### 7. 모델 규제와 하이퍼파라미터 튜닝

